- hosts: [terraform-ansible]
  tasks:
    - name: Instalando o Python3, virtualenv
      apt:
        pkg:
          - python3
          - virtualenv
          - nodejs
        update_cache: true
      become: true
    - name: Instalando dependência com pip (Django & Django Rest Framework)
      pip:
        virtualenv: /home/ubuntu/myserver/venv
        name:
          - django
          - djangorestframework
    - name: Verificando se projeto já existe
      stat:
        path: /home/ubuntu/myserver/setup/settings.py
      register: projeto_existe
    - name: Iniciando projeto
      shell: 'cd /home/ubuntu/myserver;. venv/bin/activate; django-admin startproject setup .'
      when: not projeto_existe.stat.exists
    - name: Alterando hosts permitidos
      lineinfile:
        path: /home/ubuntu/myserver/setup/settings.py
        regexp: '^ALLOWED_HOSTS'
        line: 'ALLOWED_HOSTS = ["*"]'
        backrefs: true